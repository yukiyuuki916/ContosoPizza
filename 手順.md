# C#のASP.NETでWebアプリ作成


<!-- ========================================= -->
## メモ

* VSCodeにて`ctrl + j`でターミナルを開く
* Pizza https://learn.microsoft.com/ja-jp/training/modules/create-razor-pages-aspnet-core/3-exercise-customize-project
* VSCodeにて、「SQLiteの拡張機能」が入っていれば、.dbファイルを開ける（右クリック等）

<!-- ========================================= -->
## エラー対処

`InvalidOperationException: Multiple constructors accepting all given argument types have been found in type 'ContosoPizza.Pages.PizzaListModel'. There should only be one applicable constructor.`
というエラーがブラウザ上に出た場合

### まずクリーン
rm -rf bin obj
dotnet clean

### 再ビルドして実行（エラー再現を確認）
dotnet build
dotnet run


<!-- ========================================= -->
# お勉強

* クラス: 設計図。その設計図の各項目に定義していくと、オブジェクト（インスタンス）になる。
  例: `public class Car`内の`public string Color { get; set; }`があったとする。
     これをオブジェクトにするには、
     `Car myCar = new Car();`
     `myCar.Color = "red";`
     みたいな感じにする。

* Modelsフォルダ:
  「あるデータの定義がひとまとまりになったもの」を定義するもの
  例: ピザにおける、ID、名前、価格、サイズ、...の定義

* Dataフォルダ:
  Entity Framework Core の DbContext クラスを継承したクラス。
  データベースとのやり取りを行う。
  例: `PizzaContext : DbContext`は、DbContext クラスを継承している。
      `public DbSet<ContosoPizza.Models.Pizza>? Pizzas { get; set; }`の`<>`は「どんな型を扱うか」を指定している。
      `?`は「null を許可する」という意味。↓
      `string? name = null;   // OK（nullを許容）`
      `string name = null;    // エラー（nullを許容していない）`

* Serviceフォルダ:
  `default!`:初期値はあとで入るので、nullチェック警告を無視してOK
  詳しくは「PizzaService.cs」にコメントで記載

* データベースについて:
  どのデータベースを使うかについては、「Program.cs」にて定義されている。
  詳しくはそちらにコメントで記載。
  データベースを使う方法は、
  1. データベースの「テーブルの設計図（Model/Pizza.cs）」を準備
  2. データベース全体との接続を管理するクラスを定義（Data/PizzaContext.cs）
  3. マイグレーションを作成する
     1. プロジェクトのルートフォルダに移動して、以下を実行
        `dotnet ef migrations add InitialCreate`
        * dotnet ef … Entity Framework Core のコマンド
        * migrations add … モデル定義から「変更履歴」を作成
        * InitialCreate … このマイグレーションの名前（任意）
     2. 実行すると、「Migrations」フォルダ内に「20231026000000_InitialCreate.cs」「PizzaContextModelSnapshot.cs」が作成される。
        これが「どんなテーブルを作るか」の設計図。
  4. データベースを作成する
     このコマンドを実行`dotnet ef database update`
     先ほど作ったマイグレーション（テーブル設計）をもとに実際のデータベース（ContosoPizza.db）を作成する。
  5. 「Program.cs」にて使用するデータベースを定義
  6. 「Data/PizzaContext.cs」にて「Program.cs」で渡された options（つまり「SQLite の接続情報」）を使ってDbContext を初期化

* その他:
  * _ViewImports.cshtml: 複数のページ間で使用される名前空間とクラスをインポートします。
  * _ViewStart.cshtml:   すべての Razor ページの既定のレイアウトを指定します。
  * _Layout.cshtml:      これは、_ViewStart.cshtml ファイルで指定されたレイアウトです。 複数のページ間で共通のレイアウト要素を実装します。
  * _ValidationScriptsPartial.cshtml: すべてのページに検証機能を提供します。
